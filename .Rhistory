"FTSE Russel ESG rating (ESG)"
))
df1 %>%  sumtable(., vars = var.labs1$var, labels = var.labs1, out = "csv", file = "summary1.csv")
# import financial data
longlist_3  <- read_delim("longlist_3.csv",
delim = ";",
escape_double = FALSE,
na = c("", "NA", "#N/B"))
# calculate average PERFs per Factset_sectorand year
a <- longlist_3 %>% filter(!(Sector == "#N/B")) %>%
group_by(Sector, year) %>% dplyr::summarise(mean_ROA = mean(ROA, na.rm=T), n= n(),
median_ROA = median(ROA, na.rm=T))
longlist_3 <- left_join(longlist_3, a, by = c("Sector" = "Sector", "year" = "year"))
#df1 is de data file voor regressies op alle jaren met alleen CETR en FTSE_ESG
df1 <- longlist_3 %>%
mutate(., ctrygrp = with(., case_when(
(Country %in% c("US", "JE")) ~ "USA",
(Country %in% c("SE", "DE", "FR", "CH", "NL", "BE", "DK", "ES", "IT", "FI")) ~ 'EUR',
(Country %in% c("KR", "JP", "TW")) ~ 'JKT',
(TRUE ~ "OTH")
))) %>%
mutate(PERF = ROA-mean_ROA) %>%
mutate(PERF = Winsorize(PERF, probs = c(0.01, 0.99), na.rm = TRUE),
cetr = CTP/PTI,
LEV = LTD/ASSETS,
RDS = RD/ASSETS, #R&D expenses scaled by assets
SIZE = log(ASSETS),
FOREIGN = case_when(
PTI_FOREIGN > 0 ~ 1, #foreign pre-tax income
is.na(PTI_FOREIGN)  ~ 0,
TRUE ~ 0),
FOR = case_when(
PTI_FOREIGN > 0 ~ PTI_FOREIGN/PTI, #foreign pre-tax income
is.na(PTI_FOREIGN)  ~ 0,
TRUE ~ 0),
BTD = (PTI*str*0.01-CTP)/ASSETS) #book-tax difference)
# import financial data
longlist_3  <- read_delim("longlist_3.csv",
delim = ";",
escape_double = FALSE,
na = c("", "NA", "#N/B"))
# calculate average PERFs per Factset_sectorand year
a <- longlist_3 %>% filter(!(Sector == "#N/B")) %>%
group_by(Sector, year) %>% dplyr::summarise(mean_ROA = mean(ROA, na.rm=T), n= n(),
median_ROA = median(ROA, na.rm=T))
longlist_3 <- left_join(longlist_3, a, by = c("Sector" = "Sector", "year" = "year"))
#df1 is de data file voor regressies op alle jaren met alleen CETR en FTSE_ESG
df1 <- longlist_3 %>%
mutate(., ctrygrp = with(., case_when(
(Country %in% c("US", "JE")) ~ "USA",
(Country %in% c("SE", "DE", "FR", "CH", "NL", "BE", "DK", "ES", "IT", "FI")) ~ 'EUR',
(Country %in% c("KR", "JP", "TW")) ~ 'JKT',
(TRUE ~ "OTH")
))) %>%
mutate(PERF = ROA-mean_ROA) %>%
mutate(PERF = Winsorize(PERF, probs = c(0.01, 0.99), na.rm = TRUE),
cetr = CTP/PTI,
LEV = LTD/ASSETS,
RDS = RD/ASSETS, #R&D expenses scaled by assets
SIZE = log(ASSETS),
FOREIGN = case_when(
PTI_FOREIGN > 0 ~ 1, #foreign pre-tax income
is.na(PTI_FOREIGN)  ~ 0,
TRUE ~ 0),
FOR = case_when(
PTI_FOREIGN > 0 ~ PTI_FOREIGN/PTI, #foreign pre-tax income
is.na(PTI_FOREIGN)  ~ 0,
TRUE ~ 0),
BTD = (PTI*str*0.01-CTP)/ASSETS) #book-tax difference)
#df2 is the data file voor de 2 jaren met extra berekende variabelen
df2 <- df1 %>%
select(-Column1) %>%
filter(year == 2016 | year == 2020) %>%
mutate(
LEV = LTD/ASSETS,
cetr = CTP/PTI,
RDS = RD/ASSETS, #R&D expenses scaled by assets
SIZE = log(ASSETS),
FOREIGN = case_when(
PTI_FOREIGN > 0 ~ 1, #foreign pre-tax income
is.na(PTI_FOREIGN)  ~ 0,
TRUE ~ 0),
FOR = case_when(
PTI_FOREIGN > 0 ~ PTI_FOREIGN/PTI, #foreign pre-tax income
is.na(PTI_FOREIGN)  ~ 0,
TRUE ~ 0),
BTD = (PTI*str*0.01-CTP)/ASSETS #book-tax difference
)
# # Load the SDG scores per SDG e.o. per ISIN from NLP-test
load("C:/Users/HW van der Waal/projects/NLP-test/outdata.Rdata")
out_temp <- outdata %>%
mutate(report = ifelse(is.na(doc_id), 0, 1)) %>%
group_by(company, year) %>%
summarize(sdg01 = sum(sdg01),
sdg02 = sum(sdg02),
sdg03 = sum(sdg03),
sdg04 = sum(sdg04),
sdg05 = sum(sdg05),
sdg06 = sum(sdg06),
sdg07 = sum(sdg07),
sdg08 = sum(sdg08),
sdg09 = sum(sdg09),
sdg10 = sum(sdg10),
sdg11 = sum(sdg11),
sdg12 = sum(sdg12),
sdg13 = sum(sdg13),
sdg14 = sum(sdg14),
sdg15 = sum(sdg15),
sdg16 = sum(sdg16),
sdg17 = sum(sgd17),
sdg = sum(sdg),
gc = sum(gc),
gri = sum(gri),
int = sum(int),
report = sum(report),
sdg_total = sum(sdg01:sdg17))
out_temp <- out_temp %>% rowwise() %>%
mutate(s_themes = sum(c_across(sdg01:sdg17)>0))
#check if every company per year is only mentioned once
out_temp %>% group_by(company, year) %>% summarize(n = n()) %>%
arrange(desc(n))
# join de SDG-data op de financiÃ«le data
df <- df2 %>% left_join(.,out_temp, by = c("ISIN" = "company", "year"= "year"))
df <- df %>% mutate(., ctrygrp = with(., case_when(
(Country %in% c("US", "JE")) ~ "USA",
(Country %in% c("SE", "DE", "FR", "CH", "NL", "BE", "DK", "ES", "IT", "FI")) ~ 'EUR',
(Country %in% c("KR", "JP", "TW")) ~ 'JKT',
(TRUE ~ "OTH")
)),
mutate(., across(sdg01:int, ~ifelse(is.na(.x),0,.x)))) %>%
mutate(report = ifelse(is.na(report),0, 1),
SDG = as.factor(case_when(
sdg > 0 ~ 1,
is.na(sdg)  ~ 0,
TRUE ~ 0)),
report = as.factor(case_when(
report > 0 ~ 1,
is.na(report)  ~ 0,
TRUE ~ 0)),
GC = as.factor(ifelse(gc > 0, 1, 0)),
GRI = as.factor(ifelse(gri > 0, 1, 0)),
INT = as.factor(ifelse(int> 0, 1, 0)),
cetr = CTP/PTI,
sdg_total = coalesce(sdg_total,0), #replaces NA's by 0 in this case
s_themes = coalesce(s_themes,0)
)
df$SDG <- recode(df$SDG, "1" = "SDG", "0" = "noSDG")
df$report <- recode(df$report, "1" = "report", "0" = "no report")
# and write the final data frame disk for future reference
write.csv(df, "df_tax.txt")
save(df, file = "df_tax.Rdata" )
# and write the final data frame disk for future reference
write.csv(df, "df_table.txt")
#=============================== DATA EXPLORATION SECTION ============================
# Summary statistics table
library(vtable)
# Make a summary statistics table
library(vtable)
var.labs1 <- data.frame(var = c("SIZE",
"PTI",
"CTP",
"ROA",
"PERF",
"LEV",
"cetr",
"BTD",
"str",
"FOR",
"ESG"),
labels = c("Size (log(Assets))",
"Pre-tax Income (PTI)",
"Cash Taxes Paid (CTP)",
"Return on Assets % (ROA)",
"Relative Performance (PERF)",
"Long Term Debt / Assets (LTD)",
"Cash Effective Tax Rate (CETR)",
"Book-Tax Difference / Assets (BTD)",
"Statutory Tax Rate (str)",
"Foreign Pre-tax Income Percentage (FOR)",
"FTSE Russel ESG rating (ESG)"
))
df1 %>%  sumtable(., vars = var.labs1$var, labels = var.labs1, out = "csv", file = "summary1.csv")
?sumtable
var.labs2 <- data.frame(var = c("sdg01",
"sdg02",
"sdg03",
"sdg04",
"sdg05",
"sdg06",
"sdg07",
"sdg08",
"sdg09",
"sdg10",
"sdg11",
"sdg12",
"sdg13",
"sdg14",
"sdg15",
"sdg16",
"sdg17",
"sdg",
"sdg_total",
"s_themes",
"SDG",
"GC",
"GRI",
"INT",
"report" ),
labels = c("SDG  1 No Pverty (sdg01)",
"SDG  2 Zero Hunger (sdg02)",
"SDG  3 Good Health & Wellbeing (sdg03)",
"SDG  4 Quality Education (sdg04)",
"SDG  5 Gender Equality (sdg05)",
"SDG  6 Clean Water & Sanitation (sdg06)",
"SDG  7 Affordable & Clean Energy (sdg07)",
"SDG  8 Decent Work & Econ. Growth (sdg08)",
"SDG  9 Industry, Innovation & Infrastructure (sdg09)",
"SDG 10 Reduced Inequalities (sdg10)",
"SDG 11 Sustainable Cities & Communities (sdg11)",
"SDG 12 Responsible Consumption & Production (sdg12)",
"SDG 13 Climate Action (sdg13)",
"SDG 14 Life Below Water (sdg14)",
"SDG 15 Life on Land (sdg15)",
"SDG 16 Peace, Justice & Strong Institutions (sdg16)",
"SDG 17 Partnership for the Goals (sdg17)",
"SDG & 2030 Agenda mentioning (sdg)",
"Total SDG1 - SDG 17 mentioning (sdg_total)",
"SDG Themes (number) (s_themes)",
"SDG mentioning dummy (SDG)",
"Global Compact  dummy (GC)",
"Global Reporting Initiative GRI dummy (GRI)",
"Integrated Reporting IIRC dummy (INT)",
"Sustainability report incl. integrated dummy (report)"
))
df %>%  sumtable(., vars = var.labs2$var, labels = var.labs2, out = "csv", file = "summary2.csv")
df %>%  sumtable(., vars = var.labs2$var, labels = var.labs2, out = "csv", file = "summary2.csv")
var.labs2 <- data.frame(var = c("report",
"sdg01",
"sdg02",
"sdg03",
"sdg04",
"sdg05",
"sdg06",
"sdg07",
"sdg08",
"sdg09",
"sdg10",
"sdg11",
"sdg12",
"sdg13",
"sdg14",
"sdg15",
"sdg16",
"sdg17",
"sdg",
"sdg_total",
"s_themes",
"SDG",
"GC",
"GRI",
"INT"
),
labels = c("Sustainability report incl. integrated dummy (report)",
"SDG  1 No Pverty (sdg01)",
"SDG  2 Zero Hunger (sdg02)",
"SDG  3 Good Health & Wellbeing (sdg03)",
"SDG  4 Quality Education (sdg04)",
"SDG  5 Gender Equality (sdg05)",
"SDG  6 Clean Water & Sanitation (sdg06)",
"SDG  7 Affordable & Clean Energy (sdg07)",
"SDG  8 Decent Work & Econ. Growth (sdg08)",
"SDG  9 Industry, Innovation & Infrastructure (sdg09)",
"SDG 10 Reduced Inequalities (sdg10)",
"SDG 11 Sustainable Cities & Communities (sdg11)",
"SDG 12 Responsible Consumption & Production (sdg12)",
"SDG 13 Climate Action (sdg13)",
"SDG 14 Life Below Water (sdg14)",
"SDG 15 Life on Land (sdg15)",
"SDG 16 Peace, Justice & Strong Institutions (sdg16)",
"SDG 17 Partnership for the Goals (sdg17)",
"SDG & 2030 Agenda mentioning (sdg)",
"Total SDG1 - SDG 17 mentioning (sdg_total)",
"SDG Themes (number) (s_themes)",
"SDG mentioning dummy (SDG)",
"Global Compact  dummy (GC)",
"Global Reporting Initiative GRI dummy (GRI)",
"Integrated Reporting IIRC dummy (INT)",
))
df %>%  sumtable(., vars = var.labs2$var, labels = var.labs2, out = "csv", file = "summary2.csv")
var.labs2 <- data.frame(var = c("report",
"sdg01",
"sdg02",
"sdg03",
"sdg04",
"sdg05",
"sdg06",
"sdg07",
"sdg08",
"sdg09",
"sdg10",
"sdg11",
"sdg12",
"sdg13",
"sdg14",
"sdg15",
"sdg16",
"sdg17",
"sdg",
"sdg_total",
"s_themes",
"SDG",
"GC",
"GRI",
"INT"
),
labels = c("Sustainability report incl. integrated dummy (report)",
"SDG  1 No Pverty (sdg01)",
"SDG  2 Zero Hunger (sdg02)",
"SDG  3 Good Health & Wellbeing (sdg03)",
"SDG  4 Quality Education (sdg04)",
"SDG  5 Gender Equality (sdg05)",
"SDG  6 Clean Water & Sanitation (sdg06)",
"SDG  7 Affordable & Clean Energy (sdg07)",
"SDG  8 Decent Work & Econ. Growth (sdg08)",
"SDG  9 Industry, Innovation & Infrastructure (sdg09)",
"SDG 10 Reduced Inequalities (sdg10)",
"SDG 11 Sustainable Cities & Communities (sdg11)",
"SDG 12 Responsible Consumption & Production (sdg12)",
"SDG 13 Climate Action (sdg13)",
"SDG 14 Life Below Water (sdg14)",
"SDG 15 Life on Land (sdg15)",
"SDG 16 Peace, Justice & Strong Institutions (sdg16)",
"SDG 17 Partnership for the Goals (sdg17)",
"SDG & 2030 Agenda mentioning (sdg)",
"Total SDG1 - SDG 17 mentioning (sdg_total)",
"SDG Themes (number) (s_themes)",
"SDG mentioning dummy (SDG)",
"Global Compact  dummy (GC)",
"Global Reporting Initiative GRI dummy (GRI)",
"Integrated Reporting IIRC dummy (INT)"
))
df %>%  sumtable(., vars = var.labs2$var, labels = var.labs2, out = "csv", file = "summary2.csv")
df$GC <- recode(df$GC, "1" = "GC-member", "0" = "no GC-member")
df$GRI <- recode(df$GRI, "1" = "GRI", "0" = "no GRI")
df$INT <- recode(df$INT, "1" = "<IR>", "0" = "no report<IR>")
# and write the final data frame disk for future reference
write.csv(df, "df_tax.txt")
save(df, file = "df_tax.Rdata" )
# and write the final data frame disk for future reference
write.csv(df, "df_table.txt")
var.labs1 <- data.frame(var = c("SIZE",
"PTI",
"CTP",
"ROA",
"PERF",
"LEV",
"cetr",
"BTD",
"str",
"FOR",
"ESG"),
labels = c("Size (log(Assets))",
"Pre-tax Income (PTI)",
"Cash Taxes Paid (CTP)",
"Return on Assets % (ROA)",
"Relative Performance (PERF)",
"Long Term Debt / Assets (LTD)",
"Cash Effective Tax Rate (CETR)",
"Book-Tax Difference / Assets (BTD)",
"Statutory Tax Rate (str)",
"Foreign Pre-tax Income Percentage (FOR)",
"FTSE Russel ESG rating (ESG)"
))
df1 %>%  sumtable(., vars = var.labs1$var, labels = var.labs1, out = "csv", file = "summary1.csv")
var.labs2 <- data.frame(var = c("report",
"sdg01",
"sdg02",
"sdg03",
"sdg04",
"sdg05",
"sdg06",
"sdg07",
"sdg08",
"sdg09",
"sdg10",
"sdg11",
"sdg12",
"sdg13",
"sdg14",
"sdg15",
"sdg16",
"sdg17",
"sdg",
"sdg_total",
"s_themes",
"SDG",
"GC",
"GRI",
"INT"
),
labels = c("Sustainability report incl. integrated dummy (report)",
"SDG  1 No Pverty (sdg01)",
"SDG  2 Zero Hunger (sdg02)",
"SDG  3 Good Health & Wellbeing (sdg03)",
"SDG  4 Quality Education (sdg04)",
"SDG  5 Gender Equality (sdg05)",
"SDG  6 Clean Water & Sanitation (sdg06)",
"SDG  7 Affordable & Clean Energy (sdg07)",
"SDG  8 Decent Work & Econ. Growth (sdg08)",
"SDG  9 Industry, Innovation & Infrastructure (sdg09)",
"SDG 10 Reduced Inequalities (sdg10)",
"SDG 11 Sustainable Cities & Communities (sdg11)",
"SDG 12 Responsible Consumption & Production (sdg12)",
"SDG 13 Climate Action (sdg13)",
"SDG 14 Life Below Water (sdg14)",
"SDG 15 Life on Land (sdg15)",
"SDG 16 Peace, Justice & Strong Institutions (sdg16)",
"SDG 17 Partnership for the Goals (sdg17)",
"SDG & 2030 Agenda mentioning (sdg)",
"Total SDG1 - SDG 17 mentioning (sdg_total)",
"SDG Themes (number) (s_themes)",
"SDG mentioning dummy (SDG)",
"Global Compact  dummy (GC)",
"Global Reporting Initiative GRI dummy (GRI)",
"Integrated Reporting IIRC dummy (INT)"
))
df %>%  sumtable(., vars = var.labs2$var, labels = var.labs2, out = "csv", file = "summary2.csv")
df$INT <- recode(df$INT, "1" = "<IR>", "0" = "no <IR>")
# and write the final data frame disk for future reference
write.csv(df, "df_tax.txt")
save(df, file = "df_tax.Rdata" )
# and write the final data frame disk for future reference
write.csv(df, "df_table.txt")
var.labs1 <- data.frame(var = c("SIZE",
"PTI",
"CTP",
"ROA",
"PERF",
"LEV",
"cetr",
"BTD",
"str",
"FOR",
"ESG"),
labels = c("Size (log(Assets))",
"Pre-tax Income (PTI)",
"Cash Taxes Paid (CTP)",
"Return on Assets % (ROA)",
"Relative Performance (PERF)",
"Long Term Debt / Assets (LTD)",
"Cash Effective Tax Rate (CETR)",
"Book-Tax Difference / Assets (BTD)",
"Statutory Tax Rate (str)",
"Foreign Pre-tax Income Percentage (FOR)",
"FTSE Russel ESG rating (ESG)"
))
var.labs2 <- data.frame(var = c("report",
"sdg01",
"sdg02",
"sdg03",
"sdg04",
"sdg05",
"sdg06",
"sdg07",
"sdg08",
"sdg09",
"sdg10",
"sdg11",
"sdg12",
"sdg13",
"sdg14",
"sdg15",
"sdg16",
"sdg17",
"sdg",
"sdg_total",
"s_themes",
"SDG",
"GC",
"GRI",
"INT"
),
labels = c("Sustainability report incl. integrated dummy (report)",
"SDG  1 No Pverty (sdg01)",
"SDG  2 Zero Hunger (sdg02)",
"SDG  3 Good Health & Wellbeing (sdg03)",
"SDG  4 Quality Education (sdg04)",
"SDG  5 Gender Equality (sdg05)",
"SDG  6 Clean Water & Sanitation (sdg06)",
"SDG  7 Affordable & Clean Energy (sdg07)",
"SDG  8 Decent Work & Econ. Growth (sdg08)",
"SDG  9 Industry, Innovation & Infrastructure (sdg09)",
"SDG 10 Reduced Inequalities (sdg10)",
"SDG 11 Sustainable Cities & Communities (sdg11)",
"SDG 12 Responsible Consumption & Production (sdg12)",
"SDG 13 Climate Action (sdg13)",
"SDG 14 Life Below Water (sdg14)",
"SDG 15 Life on Land (sdg15)",
"SDG 16 Peace, Justice & Strong Institutions (sdg16)",
"SDG 17 Partnership for the Goals (sdg17)",
"SDG & 2030 Agenda mentioning (sdg)",
"Total SDG1 - SDG 17 mentioning (sdg_total)",
"SDG Themes (number) (s_themes)",
"SDG mentioning dummy (SDG)",
"Global Compact  dummy (GC)",
"Global Reporting Initiative GRI dummy (GRI)",
"Integrated Reporting IIRC dummy (INT)"
))
df %>%  sumtable(., vars = var.labs2$var, labels = var.labs2, out = "csv", file = "summary2.csv")
df$INT <- recode(df$INT, "1" = "<IR>", "0" = "no <IR>")
df %>%  sumtable(., vars = var.labs2$var, labels = var.labs2, out = "csv", file = "summary2.csv")
df$INT <- recode(df$INT, "1" = "<IR>", "0" = "no <IR>")
