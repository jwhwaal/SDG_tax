summary.r(data3$TAP)
summary.r(data3$TA)
#visualize the decision tree
summary(data$TA)
library(rpart.plot)
set.seed(3, sample.kind = "Rounding")
set.seed(3, sample.kind = "Rounding")
model2 <- rpart(factor(TA) ~  SIZE + ctrygrp + Year + sdg01 + sdg02 +sdg03 +sdg04 + sdg05 +
sdg06 + sdg07 + sdg08 +sdg09 +sdg10 +sdg11 +sdg12 +sdg13 +sdg14 +sdg15 +
sdg16 + sdg17 + FOREIGN + LEV + RDS , data = df_t,
method = "class",
control = rpart.control(cp = 0.01),
na.action=na.exclude)
model2 <- rpart(factor(TA) ~  SIZE + ctrygrp + Year + sdg01 + sdg02 +sdg03 +sdg04 + sdg05 +
sdg06 + sdg07 + sdg08 +sdg09 +sdg10 +sdg11 +sdg12 +sdg13 +sdg14 +sdg15 +
sdg16 + sdg17 + FOREIGN + LEV + RDS , data = train,
method = "class",
control = rpart.control(cp = 0.01),
na.action=na.exclude)
model2 <- rpart(factor(TA) ~  SIZE + ctrygrp + Year + sdg01 + sdg02 +sdg03 +sdg04 + sdg05 +
sdg06 + sdg07 + sdg08 +sdg09 +sdg10 +sdg11 +sdg12 +sdg13 +sdg14 +sdg15 +
sdg16 + sdg17 + FOREIGN + LEV , data = train,
method = "class",
control = rpart.control(cp = 0.01),
na.action=na.exclude)
y_hat2 <- predict(model2, newdata = test)
cfm_m2 <- confusionMatrix(y_hat2, factor(test$TA), dnn = c("Prediction", "Reference"),
na.action = na.pass)
model2 <- rpart(factor(TA) ~  SIZE + ctrygrp + Year + sdg01 + sdg02 +sdg03 +sdg04 + sdg05 +
sdg06 + sdg07 + sdg08 +sdg09 +sdg10 +sdg11 +sdg12 +sdg13 +sdg14 +sdg15 +
sdg16 + sdg17 + FOREIGN + LEV , data = train,
method = "class",
control = rpart.control(cp = 0.01),
na.action=na.exclude)
y_hat2 <- predict(model2, newdata = test)
cfm_m2 <- confusionMatrix(y_hat2, factor(test$TA), dnn = c("Prediction", "Reference"),
na.action = na.pass)
y_hat2 <- predict(model2, newdata = test, type = c("class"))
cfm_m2 <- confusionMatrix(y_hat2, factor(test$TA), dnn = c("Prediction", "Reference"),
na.action = na.pass)
length(y_hat2)
length(test)
length(test$TA)
cfm_m2 <- confusionMatrix(y_hat2, factor(test$TA), dnn = c("Prediction", "Reference"),
na.action = na.pass)
set.seed(3, sample.kind = "Rounding")
model2 <- rpart(factor(TA) ~  SIZE + ctrygrp + Year + sdg01 + sdg02 +sdg03 +sdg04 + sdg05 +
sdg06 + sdg07 + sdg08 +sdg09 +sdg10 +sdg11 +sdg12 +sdg13 +sdg14 +sdg15 +
sdg16 + sdg17 + FOREIGN + LEV , data = train,
method = "class",
control = rpart.control(cp = 0.01),
na.action=na.exclude)
y_hat2 <- predict(model2, newdata = test, type = c("class"))
cfm_m2 <- confusionMatrix(y_hat2, factor(test$TA), dnn = c("Prediction", "Reference"),
na.action = na.pass)
length(y_hat2)
testing_data = complete.cases(factor(test$TA))
cfm_m2 <- confusionMatrix(y_hat2, testing_data, dnn = c("Prediction", "Reference"),
na.action = na.pass)
?predict
?rpart::predict
?caret::predict
?predict
model2 <- rpart(factor(TA) ~  SIZE + ctrygrp + Year + sdg01 + sdg02 +sdg03 +sdg04 + sdg05 +
sdg06 + sdg07 + sdg08 +sdg09 +sdg10 +sdg11 +sdg12 +sdg13 +sdg14 +sdg15 +
sdg16 + sdg17 + FOREIGN + LEV , data = train,
method = "rpart",
control = rpart.control(cp = 0.01),
na.action=na.exclude)
model2 <- rpart(factor(TA) ~  SIZE + ctrygrp + Year + sdg01 + sdg02 +sdg03 +sdg04 + sdg05 +
sdg06 + sdg07 + sdg08 +sdg09 +sdg10 +sdg11 +sdg12 +sdg13 +sdg14 +sdg15 +
sdg16 + sdg17 + FOREIGN + LEV , data = train,
method = "class",
control = rpart.control(cp = 0.01),
na.action=na.exclude)
model2 <- rpart(factor(TA) ~  SIZE + ctrygrp + Year + sdg01 + sdg02 +sdg03 +sdg04 + sdg05 +
sdg06 + sdg07 + sdg08 +sdg09 +sdg10 +sdg11 +sdg12 +sdg13 +sdg14 +sdg15 +
sdg16 + sdg17 + FOREIGN + LEV , data = train,
method = "factor",
control = rpart.control(cp = 0.01),
na.action=na.exclude)
model2 <- rpart(factor(TA) ~  SIZE + ctrygrp + Year + sdg01 + sdg02 +sdg03 +sdg04 + sdg05 +
sdg06 + sdg07 + sdg08 +sdg09 +sdg10 +sdg11 +sdg12 +sdg13 +sdg14 +sdg15 +
sdg16 + sdg17 + FOREIGN + LEV , data = train,
method = "class",
control = rpart.control(cp = 0.01),
na.action=na.exclude)
y_hat2 <- predict(model2, newdata = test, type = c("class")) %>% as.logical()
y_hat2 <- predict(model2, newdata = test, type = c("class")) %>% as.logical(as.integer())
y_hat2 <- predict(model2, newdata = test, type = c("class")) %>% as.logical(as.integer(.))
y_hat2 <- as.logical(predict(model2, newdata = test, type = c("class")))
y_hat2 <- predict(model2, newdata = test, type = c("class"))
y_hat2
testing_data
?rpart
model2 <- rpart(factor(TA) ~  SIZE + ctrygrp + Year + sdg01 + sdg02 +sdg03 +sdg04 + sdg05 +
sdg06 + sdg07 + sdg08 +sdg09 +sdg10 +sdg11 +sdg12 +sdg13 +sdg14 +sdg15 +
sdg16 + sdg17 + FOREIGN + LEV , data = train,
control = rpart.control(cp = 0.01),
na.action=na.exclude)
y_hat2 <- predict(model2, newdata = test, type = c("class"))
testing_data = complete.cases(test$TA)
cfm_m2 <- confusionMatrix(y_hat2, testing_data, dnn = c("Prediction", "Reference"),
na.action = na.pass)
y_hat2 <- predict(model2, newdata = test)
y_hat2 <- y_hat2 %>% mutate(ifelse(y_hat2 < 0.5, "TRUE", "FALSE"))
y_hat2 <- y_hat2 %>% ifelse(y_hat2 < 0.5, "TRUE", "FALSE")
model2 <- rpart(factor(TA) ~  SIZE + ctrygrp + Year + sdg01 + sdg02 +sdg03 +sdg04 + sdg05 +
sdg06 + sdg07 + sdg08 +sdg09 +sdg10 +sdg11 +sdg12 +sdg13 +sdg14 +sdg15 +
sdg16 + sdg17 + FOREIGN + LEV , data = train,
method = "class",
control = rpart.control(cp = 0.01),
na.action=na.exclude)
y_hat2 <- predict(model2, newdata = test)
y_hat2 <- predict(model2, newdata = test, method =  "class")
y_hat2 <- predict(model2, newdata = test, method =  "class")
y_hat2 <- predict(model2, newdata = test, type = "class")
model2 <- rpart(TA ~  SIZE + ctrygrp + Year + sdg01 + sdg02 +sdg03 +sdg04 + sdg05 +
sdg06 + sdg07 + sdg08 +sdg09 +sdg10 +sdg11 +sdg12 +sdg13 +sdg14 +sdg15 +
sdg16 + sdg17 + FOREIGN + LEV , data = train,
method = "class",
control = rpart.control(cp = 0.01),
na.action=na.exclude)
y_hat2 <- predict(model2, newdata = test, type = "class")
y_hat2 <- y_hat2 %>% ifelse(y_hat2 < 0.5, "TRUE", "FALSE")
testing_data = complete.cases(test$TA)
cfm_m2 <- confusionMatrix(y_hat2, testing_data, dnn = c("Prediction", "Reference"),
na.action = na.pass)
#create a data partition
data <- df_t %>% select(cetr_5_s, SIZE, Year, report,  ROA, sdg,
LEV, FOREIGN, ctrygrp, Sector, SDG, sdg01:sdg17) %>%
drop_na() %>% mutate(SDG = as.factor(as.numeric(SDG)),
TA = as.factor(ifelse(cetr_5_s < median(df_t$cetr_5_s), 1, 0)))
set.seed(1, sample.kind = "Rounding")
trainIndex <- createDataPartition(data$TA, p = .5,
list = FALSE,
times = 1)
summary(df_t)
#  mutate(SDG = as.factor(SDG))
train <- data[trainIndex,]
test <- data[-trainIndex,]
set.seed(3, sample.kind = "Rounding")
model2 <- rpart(TA ~  SIZE + ctrygrp + Year + sdg01 + sdg02 +sdg03 +sdg04 + sdg05 +
sdg06 + sdg07 + sdg08 +sdg09 +sdg10 +sdg11 +sdg12 +sdg13 +sdg14 +sdg15 +
sdg16 + sdg17 + FOREIGN + LEV , data = train,
method = "class",
control = rpart.control(cp = 0.01),
na.action=na.exclude)
y_hat2 <- predict(model2, newdata = test, type = "class")
testing_data = complete.cases(test$TA)
cfm_m2 <- confusionMatrix(y_hat2, testing_data, dnn = c("Prediction", "Reference"),
na.action = na.pass)
cfm_m2 <- confusionMatrix(y_hat2, test$TA, dnn = c("Prediction", "Reference"),
na.action = na.pass)
length(y_hat2)
length(test$TA)
importance <- as.data.frame(model2$variable.importance)
plot(model2)
rpart.plot(model2, type = 2)
model2 <- rpart(TA ~  SIZE + ctrygrp + Year + sdg01 + sdg02 +sdg03 +sdg04 + sdg05 +
sdg06 + sdg07 + sdg08 +sdg09 +sdg10 +sdg11 +sdg12 +sdg13 +sdg14 +sdg15 +
sdg16 + sdg17 + FOREIGN + LEV , data = train,
method = "class",
control = rpart.control(cp = 0.001),
na.action=na.exclude)
y_hat2 <- predict(model2, newdata = test, type = "class")
cfm_m2 <- confusionMatrix(y_hat2, test$TA, dnn = c("Prediction", "Reference"),
na.action = na.pass)
length(y_hat2)
length(test$TA)
importance <- as.data.frame(model2$variable.importance)
plot(model2)
rpart.plot(model2, type = 2)
library(readr)
library(tidyverse)
library(readxl)
# DATA LOADING AND WRANGLING
#read the master financial data of the sample from the Factset Excel-sheet
data <- read_excel("sample_report.xlsx",
sheet = "sample_long") %>%
filter(Year %in% c(2016, 2020))
#import statutory tax rates from Tax Foundation.org
taxrates_81_21 <- read_excel("taxrates_81_21.xlsx")
tr <- taxrates_81_21 %>% filter(iso_2 %in% unique(data$Country) & year %in% c(2016:2020)) %>%
mutate(stat_rate=as.numeric(rate)) %>%
select(iso_2, country, year, stat_rate)
unique(data$Country)
# import Cetr_5_scaled file calculated separately.
longlist_3 <- read_delim("longlist_3.csv",
";", escape_double = FALSE,
col_types = cols(str = col_number(),
PTI = col_number(), CTP = col_number(),
cetr_5 = col_number(), diff = col_number(),
cetr_5_s = col_number()), trim_ws = TRUE,
na =c("#N/B")) %>%
filter(year %in% c(2016, 2020))
#join the cetr_5_scaled data and the country/year statutory tax rates on the Factset data and
data1 <- data %>% left_join(.,longlist_3, by = c("Year" = "year", "ISIN" = "ISIN", "Country" = "Country" )) %>%
select(ISIN, Sector, Year, LTD, RD, PTI_FOREIGN, PTI, CTP, cetr_5, cetr_5_s, ASSETS, Country, ROA, MCAP) %>%
mutate(LTD = as.numeric(LTD), RD = as.numeric(RD), PTI_FOREIGN = as.numeric(PTI_FOREIGN)) %>%
left_join(.,tr, by = c("Country" = "iso_2", "Year" = "year")) %>%
mutate(across(PTI:cetr_5_s, as.numeric))
logit conversion function to be used with "SHELTER", Wilson 2009. Is een logistic,
#logit conversion function to be used with "SHELTER", Wilson 2009. Is een logistic,
logit2prob = function(logit){
odds <- exp(logit)
prob <- odds / (1 + odds)
return(prob)
}
#create new variables. TAP = Tax aggressiveness probability
data2 <- data1 %>% mutate(
LEV = LTD/ASSETS,
RDS = RD/ASSETS, #R&D expenses scaled by assets
SIZE = log(ASSETS),
FOREIGN = case_when(
PTI_FOREIGN > 1 ~ 1, #foreign pre-tax income
is.na(PTI_FOREIGN)  ~ 0,
TRUE ~ 0),
BTD = (PTI*stat_rate*0.01-CTP)/ASSETS, #book-tax difference
SHELTER = -4.30 + 6.63*BTD -1.72*LEV +
0.66*SIZE + 2.26*ROA + 1.62*FOREIGN + 1.56*RDS, #Wilson's Tax Shelter Probability
TAP = as.factor(round(logit2prob(SHELTER),0))
)
is.na(data2$TAP)
# Load the SDG scores per SDG e.o. per ISIN from NLP-test
load("C:/Users/HW van der Waal/projects/NLP-test/outdata.Rdata")
out_temp <- outdata %>%
mutate(report = ifelse(is.na(doc_id), 0, 1)) %>%
group_by(company, year) %>%
summarize(sdg01 = sum(sdg01),
sdg02 = sum(sdg02),
sdg03 = sum(sdg03),
sdg04 = sum(sdg04),
sdg05 = sum(sdg05),
sdg06 = sum(sdg06),
sdg07 = sum(sdg07),
sdg08 = sum(sdg08),
sdg09 = sum(sdg09),
sdg10 = sum(sdg10),
sdg11 = sum(sdg11),
sdg12 = sum(sdg12),
sdg13 = sum(sdg13),
sdg14 = sum(sdg14),
sdg15 = sum(sdg15),
sdg16 = sum(sdg16),
sdg17 = sum(sgd17),
sdg = sum(sdg),
gc = sum(gc),
gri = sum(gri),
int = sum(int),
report = sum(report))
out_temp %>% group_by(company, year)  %>% summarize(n = n()) %>% arrange(desc(n))
length(unique(out_temp$company))
length()
df <- data2 %>% left_join(.,out_temp, by = c("ISIN" = "company", "Year"= "year"))
out_temp <- outdata %>%
mutate(report = ifelse(is.na(doc_id), 0, 1)) %>%
group_by(company, year) %>%
summarize(sdg01 = sum(sdg01),
sdg02 = sum(sdg02),
sdg03 = sum(sdg03),
sdg04 = sum(sdg04),
sdg05 = sum(sdg05),
sdg06 = sum(sdg06),
sdg07 = sum(sdg07),
sdg08 = sum(sdg08),
sdg09 = sum(sdg09),
sdg10 = sum(sdg10),
sdg11 = sum(sdg11),
sdg12 = sum(sdg12),
sdg13 = sum(sdg13),
sdg14 = sum(sdg14),
sdg15 = sum(sdg15),
sdg16 = sum(sdg16),
sdg17 = sum(sgd17),
sdg = sum(sdg),
gc = sum(gc),
gri = sum(gri),
int = sum(int),
report = sum(report))
out_temp %>% group_by(company, year)  %>% summarize(n = n()) %>% arrange(desc(n))
length(unique(out_temp$company))
length()
df <- data2 %>% left_join(.,out_temp, by = c("ISIN" = "company", "Year"= "year"))
df <- df %>% mutate(., ctrygrp = with(., case_when(
(Country %in% c("US", "JE")) ~ "USA",
(Country %in% c("SE", "DE", "FR", "CH", "NL", "BE", "DK", "ES", "IT", "FI")) ~ 'EUR',
(Country %in% c("KR", "JP", "TW")) ~ 'JKT',
(TRUE ~ "OTH")
)),
mutate(., across(sdg01:int, ~ifelse(is.na(.x),0,.x)))) %>%
mutate(report = ifelse(is.na(report),0, 1))
# and write the final data frame disk for future reference
write.csv(df, "df_table.txt")
df <- df %>%
mutate(
SDG = as.factor(case_when(
sdg > 0 ~ 1,
is.na(sdg)  ~ 0,
TRUE ~ 0)),
report = as.factor(case_when(
report > 0 ~ 1,
is.na(report)  ~ 0,
TRUE ~ 0)),
GC = as.factor(ifelse(gc > 0, 1, 0)),
GRI = as.factor(ifelse(gri > 0, 1, 0)),
INT = as.factor(ifelse(int> 0, 1, 0))
)
df$SDG <- recode(df$SDG, "1" = "SDG", "0" = "noSDG")
df$report <- recode(df$report, "1" = "report", "0" = "no report")
df$TAP <- recode(df$TAP, "1" = "Tax Aggressive", "0" = "Not Tax Aggressive")
#check how many different companies there are. It should be 300
length(unique(df$ISIN))
# Make a summary statistics table
library(vtable)
out_temp <- outdata %>%
mutate(report = ifelse(is.na(doc_id), 0, 1)) %>%
group_by(company, year) %>%
summarize(sdg01 = sum(sdg01),
sdg02 = sum(sdg02),
sdg03 = sum(sdg03),
sdg04 = sum(sdg04),
sdg05 = sum(sdg05),
sdg06 = sum(sdg06),
sdg07 = sum(sdg07),
sdg08 = sum(sdg08),
sdg09 = sum(sdg09),
sdg10 = sum(sdg10),
sdg11 = sum(sdg11),
sdg12 = sum(sdg12),
sdg13 = sum(sdg13),
sdg14 = sum(sdg14),
sdg15 = sum(sdg15),
sdg16 = sum(sdg16),
sdg17 = sum(sgd17),
sdg = sum(sdg),
gc = sum(gc),
gri = sum(gri),
int = sum(int),
report = sum(report),
type = str_sub(doc_id, 19,20))
df <- data2 %>% left_join(.,out_temp, by = c("ISIN" = "company", "Year"= "year"))
df <- df %>% mutate(., ctrygrp = with(., case_when(
(Country %in% c("US", "JE")) ~ "USA",
(Country %in% c("SE", "DE", "FR", "CH", "NL", "BE", "DK", "ES", "IT", "FI")) ~ 'EUR',
(Country %in% c("KR", "JP", "TW")) ~ 'JKT',
(TRUE ~ "OTH")
)),
mutate(., across(sdg01:int, ~ifelse(is.na(.x),0,.x)))) %>%
mutate(report = ifelse(is.na(report),0, 1))
# and write the final data frame disk for future reference
write.csv(df, "df_table.txt")
#CREATE SUBSET FOR IR REPORTS
df_IR <- df %>% filter(type == "IR")
# and write the final data frame disk for future reference
write.csv(df, "df_table.txt")
save(df, file = "df_tax.Rdata" )
# and write the final data frame disk for future reference
write.csv(df, "df_tax.txt")
load("~/NLP-test/taxhaven.Rdata")
?load
path.expand()
path.expand("~/NLP-test/taxhaven.Rdata")
load("~/NLP-test/taxhaven.Rdata")
load(path.expand("~/NLP-test/taxhaven.Rdata"))
load("C:/Users/HW van der Waal/projects/NLP-test/taxhaven.Rdata")
path.expand("~/NLP-test/taxhaven.Rdata")
df_IR <- df_IR %>% left_join(.,taxhaven)
load("C:/Users/HW van der Waal/projects/NLP-test/taxhaven.Rdata")
taxhaven
load("C:/Users/HW van der Waal/projects/NLP-test/taxhaven.Rdata")
load("taxhaven.Rdata")
taxhaven
load("C:/Users/HW van der Waal/projects/SDG_tax/taxhaven.Rdata")
df_IR <- df_IR %>% left_join(.,taxhaven)
?load
attach("taxhaven.Rdata")
taxhaven
load(outdata.Rdata)
load("outdata.Rdata")
load("taxhaven.Rdata")
attach("~/NLP-test/taxhaven.Rdata")
library(readr)
th <- read_csv("th.csv")
View(th)
View(th)
th <- read_csv("th.csv") %>% -select('...1')
library(tidyverse)
th <- read_csv("th.csv") %>% -select('...1')
th <- read_csv("th.csv") %>% select(-'...1')
th <- read_csv("th.csv") %>% select(-'...1') %>%
mutate(year = str_sub(doc_id, 14,17))
th <- read_csv("th.csv") %>% select(-'...1') %>%
mutate(year = as.double(str_sub(doc_id, 14,17)))
?left_join
df_IR <- df_IR %>% left_join(.,th,
by = c( "ISIN" = "company"), c("Year" = "year")))
df_IR <- df_IR %>% left_join(.,th,
by = c( "ISIN" = "company"), c("Year" = "year"))
df_IR %>% ggplot(aes(cetr_5_s, th)) +
geom_point()
df_IR %>% ggplot(aes(cetr_5_s, th, col = ctrygrp)) +
geom_point()
df_IR %>% ggplot(aes(cetr_5, th, col = ctrygrp)) +
geom_point()
df_IR %>% ggplot(aes(cetr_5_s, taxhaven, col = ctrygrp)) +
geom_point()
df_IR %>% ggplot(aes(cetr_5_s, th, col = ctrygrp)) +
geom_point() +
geom_smooth()
df_IR %>% filter(ctrygrp == "EUR") %>%
ggplot(aes(cetr_5_s, th, col = ctrygrp)) +
geom_point() +
geom_smooth()
df_IR %>% filter(ctrygrp == "EUR" & cetr_5_s > -0.25 & cetr_5_s < 0.25) %>%
ggplot(aes(cetr_5_s, th, col = ctrygrp)) +
geom_point() +
geom_smooth()
library(tidyverse)
library(readr)
th <- read_csv("th.csv") %>% select(-'...1') %>%
mutate(year = as.double(str_sub(doc_id, 14,17)))
View(th)
View(th)
df_IR <- df_IR %>% left_join(.,th,
by = c( "ISIN" = "company"), c("Year" = "year"))
df_IR %>% filter(ctrygrp == "EUR" & cetr_5_s > -0.25 & cetr_5_s < 0.25) %>%
ggplot(aes(cetr_5_s, eu_noncoop, col = ctrygrp)) +
geom_point() +
geom_smooth()
df_IR %>% filter(ctrygrp == "EUR" & cetr_5_s > -0.25 & cetr_5_s < 0.25) %>%
mutate(th = as.factor(if_else(eu_noncoop > 0,1,0))) %>%
ggplot(aes(cetr_5_s, th, col = ctrygrp)) +
geom_boxplot() +
geom_smooth()
df_IR %>% filter(ctrygrp == "EUR" & cetr_5_s > -0.25 & cetr_5_s < 0.25) %>%
mutate(th = as.factor(if_else(eu_noncoop > 0,1,0))) %>%
ggplot(aes(cetr_5_s, th, col = ctrygrp)) +
geom_boxplot()
df_IR %>% filter(ctrygrp == "EUR" & cetr_5_s > -0.25 & cetr_5_s < 0.1) %>%
mutate(th = as.factor(if_else(eu_noncoop > 0,1,0))) %>%
ggplot(aes(cetr_5_s, th, col = ctrygrp)) +
geom_boxplot()
df_IR <- df_IR %>% left_join(.,th,
by = c( "ISIN" = "company"), c("year" = "year"))
df_IR %>% filter(ctrygrp == "EUR" & cetr_5_s > -0.25 & cetr_5_s < 0.25) %>%
mutate(th = as.factor(if_else(eu_noncoop > 0,1,0))) %>%
ggplot(aes(cetr_5_s, th, col = ctrygrp)) +
geom_boxplot()
df_IR <- df_IR %>% left_join(.,th,
by = c( "ISIN" = "company"), c("Year" = "year"))
df_IR %>% filter(ctrygrp == "EUR" & cetr_5_s > -0.25 & cetr_5_s < 0.25) %>%
mutate(th = as.factor(if_else(eu_noncoop > 0,1,0))) %>%
ggplot(aes(cetr_5_s, th, col = year.x)) +
geom_boxplot()
df_IR %>% filter(ctrygrp == "EUR" & cetr_5_s > -0.25 & cetr_5_s < 0.25) %>%
mutate(th = as.factor(if_else(eu_noncoop > 0,1,0))) %>%
ggplot(aes(cetr_5_s, th, col = year.x)) +
geom_boxplot() +
facte_grid(~. year.x)
df_IR %>% filter(ctrygrp == "EUR" & cetr_5_s > -0.25 & cetr_5_s < 0.25) %>%
mutate(th = as.factor(if_else(eu_noncoop > 0,1,0))) %>%
ggplot(aes(cetr_5_s, th, col = year.x)) +
geom_boxplot() +
facet_grid(~. year.x)
df_IR %>% filter(ctrygrp == "EUR" & cetr_5_s > -0.25 & cetr_5_s < 0.25) %>%
mutate(th = as.factor(if_else(eu_noncoop > 0,1,0))) %>%
ggplot(aes(cetr_5_s, th, col = year.x)) +
geom_boxplot() +
facet_grid(~ . year)
View(df_IR)
View(df_IR)
df_IR %>% filter(ctrygrp == "EUR" & cetr_5_s > -0.25 & cetr_5_s < 0.25) %>%
mutate(th = as.factor(if_else(eu_noncoop > 0,1,0))) %>%
ggplot(aes(cetr_5_s, th)) +
geom_boxplot() +
facet_grid(~ . year)
df_IR %>% filter(ctrygrp == "EUR" & cetr_5_s > -0.25 & cetr_5_s < 0.25) %>%
mutate(th = as.factor(if_else(eu_noncoop > 0,1,0))) %>%
ggplot(aes(cetr_5_s, th)) +
geom_boxplot() +
facet_grid(~ . Year)
df_IR %>% filter(ctrygrp == "EUR" & cetr_5_s > -0.25 & cetr_5_s < 0.25) %>%
mutate(th = as.factor(if_else(eu_noncoop > 0,1,0))) %>%
ggplot(aes(cetr_5_s, th)) +
geom_boxplot() +
facet_grid(. ~ Year)
df_IR %>% filter(ctrygrp == "EUR" & cetr_5 > 0 & cetr_5 < 0.5) %>%
mutate(th = as.factor(if_else(eu_noncoop > 0,1,0))) %>%
ggplot(aes(cetr_5_s, th)) +
geom_boxplot() +
facet_grid(. ~ Year)
table(df_IR)
df_IR_th <- df_IR %>% filter(ctrygrp == "EUR" & cetr_5 > 0 & cetr_5 < 0.5) %>%
mutate(th = as.factor(if_else(eu_noncoop > 0,1,0)))
df_IR %>% group_by(Tear, ctrygrp)
df_IR %>% group_by(Year, ctrygrp)
df_IR %>% group_by(Year, ctrygrp) %>%
summarize(m = median(cetr_5_s))
df_IR %>% group_by(Year, th) %>%
summarize(m = median(cetr_5_s))
df_IR_th %>% group_by(Year, th) %>%
summarize(m = median(cetr_5_s))
df_IR_th %>% group_by(Year, th) %>%
summarize(m = median(cetr_5_s),
sum = sum(eu_noncoop))
library(readr)
library(tidyverse)
library(readxl)
data <- read_excel("sample_report.xlsx",
sheet = "sample_long") %>%
filter(Year %in% c(2016, 2020))
